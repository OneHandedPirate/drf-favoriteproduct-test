## Favorite Products Test
<hr>

<details>
<summary>ТЗ</summary>

**Реализовать возможность добавления и удаления продуктов в "Избранное" для
авторизованных пользователей.**

Модель продукта:
```python
class Product(models.Model):
    name = models.CharField(max_length=255)
    description = models.TextField()
    price = models.DecimalField(max_digits=10, decimal_places=2)
```

**Что нужно сделать (Условия):**
1. Добавить функциональность избранного:<br>
    Один пользователь может добавлять несколько продуктов в избранное.
    Пользователь не может добавить в избранное больше 5 продуктов (значение
    может меняться в настройках)
    Один и тот же продукт может быть в избранном у разных пользователей.
    Пользователь может удалить продукт из своего избранного.
2. Модель избранного:<br>
Создайте отдельную модель или реализуйте через ManyToManyField , если это
уместно.
3. API / Views:<br>
Реализовать API или views, с помощью которых можно:
Добавить продукт в избранное
Удалить продукт из избранного
Получить список избранных продуктов текущего пользователя
4. Авторизация:<br>
Только авторизованные пользователи могут работать с избранным.
Гость (неавторизованный пользователь) не может добавлять/удалять/
просматривать избранное.
5. Админка (опционально):<br>
Настроить отображение избранных продуктов у пользователя.
6. Тесты (опционально):<br>
Покрыть базовую логику добавления и удаления избранного юнит-тестами или
тестами API.
</details>

#### Требования:
1. установленный пакетный менеджер `uv` (инструкции по установке <a href="https://docs.astral.sh/uv/getting-started/installation/#uv">здесь</a>)
2. установленный докер (опционально, для поднятия dev БД)

#### Установка:
1. Склонировать репозиторий и перейти в директорию проекта:
    ```
    git clone https://github.com/OneHandedPirate/drf-favoriteproduct-test
    cd drf-favoriteproduct-test
    ```
2. Создать dev-окружение:
    ```
    make create_dev_env
    ```
3. Создать минимальный `.env`-файл с конфигом для БД
    ```
    make create_dev_env_file
    ```
    Примечание: можно добавить переменную `PRODUCTS__MAX_FAV_PER_USER` для указания максимально допустимого количества избранных продуктов на юзера (по умолчанию 5)
4. Поднять dev БД в докере (опционально):
    ```
    make up_dev_db
    ```
   **Примечание:** если вы используете свою БД - внесите изменения в `.env`.
5. Накатить миграции:
    ```
    make make_migrations
    ```
6. Накатить dev-фикстуры из дампа (1 суперюзер admin/admin, 30 записей продуктов, лежат в `db_dump`):
    ```
    make load_dev_data 
    ```
7. Запустить dev-сервер на 8000 порту:
    ```
    make start_dev
    ```


#### Эндпоинты
- **[Auth]**
    
    - `/api/auth/token/` [POST] (all) - получение access/refresh токенов.
        
      - Тело запроса:
        ```
        {
            "username": <string>,
            "password": <string>
        }
        ```
      - Ответ:
        ```
        {
            "access": <string>,
            "refresh": <string>
        }
        ```
        <br>
  
    - `/api/auth/refresh/` [POST] (all) - обновление токенов по refresh токену.
        
      - Тело запроса:
        ```
        {
            "refresh": <string>,
        }
        ```
        - Ответ:
        ```
        {
            "access": <string>,
            "refresh": <string>
        }
        ```
        Примечание: по умолчанию обновляется оба токена, для изменения внести в `.env` переменную `AUTH__ROTATE_REFRESH_TOKEN=False`. Так же можно увеличить время жизни access-токена для удобства тестирования (по умолчанию 15 минут), добавив переменную `AUTH__ACCESS_TOKEN_LIFETIME_MINUTES=<время жизни токена в минутах>`<br><br>
    
    - `/api/auth/verify/` - [POST] (all) - проверяет валидность токена.
        
      - Тело запроса:
        ```
        {
            "token": <string>
        }
        ```
      - Ответ: 
        ```
        {}
        ```
      Если токен не валидный - статус ответа `401`
      <br><br>
  
- **[Users]**
    
    - `/api/users/profile/` - [GET] (auth) - профиль аутентифицированного пользователя (в данной реализации в ответе только `id` и `username` текущего пользователя)
    <br><br>

- **[Products]**

    - `api/products/` - [GET] (all) - список продуктов (с пагинацией).
        
      - Query-параметры:
         - `page` - номер страницы
         - `page_size` - количество продуктов на странице.
        <br><br>
    
    - `api/products/favorites/` - [GET] (auth) - список избранных продуктов для текущего юзера (с пагинацией).
        - Query-параметры:
         - `page` - номер страницы
         - `page_size` - количество продуктов на странице.
        <br><br>
    
    - `api/products/<product_id>/add-to-favorites/` - [POST] (auth) - добавить продукт в избранное.<br><br>
    - `api/products/<product_id>/remove-from-favorites/` - [DELETE] (auth) - удалить продукт из избранного.<br><br>

- **[Service]**
    
    - `api/healthcheck/` - [GET] (all) - проверка статуса приложения.
        
        - Ответ:
          ```
          {
            "status": "OK"
          }
          ```
          <br>
    
    - `api/schema/swagger-ui/` - API-документация. **Только для авторизованных в админке.**<br><br>
    - `silk/` - (только в DEV-режиме) (all) - Silk profiler
<br><br>
  
#### Тесты
Для запуска тестов выполнить команду:
```
make run_tests
```

Добавлены unit-тесты для сервисов `AddFavoriteProductService` и `DeleteFavoriteProductService`, отвечающих за логику добавления/удаления избранных продуктов юзера.